(function(){function e(e,n){for(var r=-1,t=n.length>>>0;++r<t;)if(e===n[r])return!0;return!1}var n,r,t,o,i,u,c,a,s,l,f,h,g,p,m,d,y;if(n=require("./conf"),r=require("./api-btc-e"),t=require("./api-poloniex"),o=require("node-telegram-bot-api"),i=require("ms"),!n.tokenTelegram)return void console.log("There is no token Telegram!".red);u="poloniex"===n.exchange?new t:new r,c=new o(n.tokenTelegram,{polling:!0}),a=function(e,r){e.length>4096&&(e="Слишком много информации для отображения"),e.length||(e="Error: Не удалось обработать ошибку"),c.sendMessage(n.myChatId,e,r)},s=function(){return(new Date).toLocaleTimeString("en-US",{timeZone:n.timeZone,hour12:!1})},l=function(e){var n;return n="",Object.keys(e).forEach(function(r){if(e.hasOwnProperty(r))return n+=r+" :: "+e[r]+"\n"}),n},f=function(e){return"object"==typeof e?e.hasOwnProperty("error")?e.error:e.hasOwnProperty("message")?e.message:l(e):e},h=function(e,n){return null==n&&(n=3),+(+e).toFixed(n)},g=function(e,r){return e/r*(1-n.fee/100)},p=function(e,r){return e*r*(1-n.fee/100)},c.on("message",function(e){var r;if(r=e.chat.id,n.myChatId||c.sendMessage(r,"Install your Telegram id: "+r),r===n.myChatId)return"Круг"===e.text?y():void 0}),d=function(e){return u.getInfo(function(n,r){return null!=n?e(n):(m=Object.keys(r.pairs),e(null))})},y=function(n,r){var t,o,i,c;null==n&&(n=.993),null==r&&(r=!1),t={},o={},i={},c={},m.forEach(function(e){var n;n=e.split(/\s*_\s*/),t[n[0]]?t[n[0]].push(n[1]):t[n[0]]=[n[1]]}),u.getTicker(m.join("-"),function(u,s){var l,d,y,v;return null!=u?(l=f(u),a("Error: "+l)):(m.forEach(function(e){o[e]=g(1,s[e].buy)}),m.forEach(function(e){var n;n=e.split(/\s*_\s*/),t[n[0]].forEach(function(r){r!==n[1]&&(i[n[1]+"_"+n[0]+"_"+r]=p(o[e],s[n[0]+"_"+r].sell))})}),Object.keys(i).forEach(function(r){var t,o;t=r.split(/\s*_\s*/),e(t[0]+"_"+t[2],m)&&(o=g(i[r],s[t[0]+"_"+t[2]].buy)),e(t[2]+"_"+t[0],m)&&(o=p(i[r],s[t[2]+"_"+t[0]].buy)),o>n&&(c[r+"_"+t[0]]=h(o,5))}),d=["Проверка возможных вариантов перепродаж.","Показаны значения больше: "+n,"Значения меньше 1 убыточны:\n"],y=[],Object.keys(c).forEach(function(e){y.push([e.replace(/\_/g,"->"),c[e]])}),y.length?(v=y.sort(function(e,n){return n[1]-e[1]}),v.forEach(function(e){d.push(e.join(": "))})):d.push("Нет подходящих вариантов"),!r||y.length?a(d.join("\n")):void 0)})},function(){n.myChatId&&(console.log("["+s()+"]: Notification Bot starting..."),console.log("["+s()+"]: Exchange: "+n.exchange.toUpperCase()),d(function(e){var n;return null!=e&&(n=f(e),console.log(("["+s()+"]: Error getting parameters from the server!\n"+n).red),process.exit(0)),setInterval(function(){y(1,!0)},i("30s")),console.log("["+s()+"]: Notification Bot started")}))}()}).call(this);